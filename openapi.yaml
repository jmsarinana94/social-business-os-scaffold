openapi: 3.0.3
info:
  title: Social Business OS API (Mock)
  version: 1.0.0
servers:
  - url: http://127.0.0.1:4010
tags:
  - name: Auth
  - name: Orgs
  - name: Products
  - name: Accounts
  - name: Orders

paths:
  /auth/signup:
    post:
      tags: [Auth]
      summary: Sign up and get token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string } # keep permissive so Prism wonâ€™t 422
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user:
                    type: object
                    properties:
                      id: { type: string }
                      email: { type: string, format: email }
                required: [token]
              examples:
                default:
                  value:
                    token: mock.jwt.token
                    user:
                      id: usr_123
                      email: tester@example.com

  /auth/login:
    post:
      tags: [Auth]
      summary: Login and get token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                required: [token]
              examples:
                default:
                  value:
                    token: mock.jwt.token

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: string }
                  email: { type: string, format: email }
                required: [id, email]
              examples:
                default:
                  value:
                    id: usr_123
                    email: tester@example.com
        '401':
          description: Unauthorized

  /orgs:
    post:
      tags: [Orgs]
      summary: Create an org
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [slug, name]
              properties:
                slug: { type: string }
                name: { type: string }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Org'
  /orgs/{slug}:
    get:
      tags: [Orgs]
      summary: Get org by slug
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Org' }

  /products:
    get:
      tags: [Products]
      summary: List products
      parameters:
        - in: query
          name: sku
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Product' }
        '400':
          description: Missing X-Org header
    post:
      tags: [Products]
      summary: Upsert product (org-scoped)
      parameters:
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/ProductWrite'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Product' }
        '409':
          description: Duplicate SKU in same org
        '400':
          description: Missing X-Org header

  /products/{id}:
    get:
      tags: [Products]
      summary: Get product by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Product' }
        '400':
          description: Missing X-Org header
    patch:
      tags: [Products]
      summary: Update product fields
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                status: { type: string, enum: [ACTIVE, INACTIVE] }
                price: { type: number }
                inventoryQty: { type: integer, minimum: 0 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Product' }
        '400':
          description: Missing X-Org header
    delete:
      tags: [Products]
      summary: Delete product
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '204':
          description: No Content
        '400':
          description: Missing X-Org header

  /products/{id}/inventory:
    post:
      tags: [Products]
      summary: Adjust inventory
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [delta]
              properties:
                delta: { type: integer } # can be negative
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Product' }
        '400':
          description: Missing X-Org header

  /accounts:
    get:
      tags: [Accounts]
      summary: List accounts within org
      parameters:
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Account' }
        '400':
          description: Missing X-Org header
    post:
      tags: [Accounts]
      summary: Create account within org
      parameters:
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountWrite'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Account' }
        '400':
          description: Missing X-Org header

  /accounts/{id}:
    get:
      tags: [Accounts]
      summary: Get account by id within org
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Account' }
        '400':
          description: Missing X-Org header
    patch:
      tags: [Accounts]
      summary: Update account within org
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Account' }
        '400':
          description: Missing X-Org header
    delete:
      tags: [Accounts]
      summary: Delete account within org
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '204':
          description: No Content
        '400':
          description: Missing X-Org header

  /orders:
    get:
      tags: [Orders]
      summary: List orders (most recent first)
      parameters:
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Order' }
        '400':
          description: Missing X-Org header
    post:
      tags: [Orders]
      summary: Create order
      parameters:
        - in: header
          name: X-Org
          required: true
          schema: { type: string }
        - in: header
          name: Idempotency-Key
          required: false
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [items]
              properties:
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    additionalProperties: false
                    required: [productId, qty, unitPrice]
                    properties:
                      productId: { type: string }
                      qty: { type: integer, minimum: 1 }
                      unitPrice: { type: string, pattern: '^[0-9]+(\.[0-9]{2})$' }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Order' }
        '400':
          description: Missing X-Org header

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Org:
      type: object
      properties:
        id: { type: string }
        slug: { type: string }
        name: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    Product:
      type: object
      properties:
        id: { type: string }
        orgId: { type: string }
        sku: { type: string }
        title: { type: string }
        type: { type: string, enum: [PHYSICAL, DIGITAL] }
        status: { type: string, enum: [ACTIVE, INACTIVE] }
        price: { type: number }
        inventoryQty: { type: integer }
        lastPurchasedAt: { type: string, format: date-time }

    ProductWrite:
      type: object
      additionalProperties: false
      required: [sku, title, type, status, price, inventoryQty]
      properties:
        sku: { type: string }
        title: { type: string }
        type: { type: string, enum: [PHYSICAL, DIGITAL] }
        status: { type: string, enum: [ACTIVE, INACTIVE] }
        price: { type: number }
        inventoryQty: { type: integer, minimum: 0 }

    Account:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    AccountWrite:
      type: object
      additionalProperties: false
      required: [name]
      properties:
        name: { type: string }

    OrderItem:
      type: object
      properties:
        id: { type: string }
        orderId: { type: string }
        productId: { type: string }
        qty: { type: integer }
        unitPrice: { type: string }

    Order:
      type: object
      properties:
        id: { type: string }
        orgId: { type: string }
        totalQty: { type: integer }
        totalPrice: { type: string }
        createdAt: { type: string, format: date-time }
        items:
          type: array
          items: { $ref: '#/components/schemas/OrderItem' }
