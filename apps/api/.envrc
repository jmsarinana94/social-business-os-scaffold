# ========================================================================
# apps/api/.envrc
# ========================================================================
# üß© Purpose: Auto-load local environment variables for the API
# ========================================================================

# ------------------------------------------------------------------------
# 1Ô∏è‚É£ Load environment variables from prisma/.env (if it exists)
# ------------------------------------------------------------------------
# This allows your Prisma config (DATABASE_URL, etc.) to load automatically.
dotenv_if_exists prisma/.env

# ------------------------------------------------------------------------
# 2Ô∏è‚É£ Core runtime configuration for local dev
# ------------------------------------------------------------------------
export NODE_ENV=${NODE_ENV:-development}
export PORT=${PORT:-4010}

# JWT secret for local testing ‚Äî never use this in production.
export JWT_SECRET=${JWT_SECRET:-dev_local_jwt_secret}

# ------------------------------------------------------------------------
# 3Ô∏è‚É£ Base URL used by smoke.sh and e2e tests
# ------------------------------------------------------------------------
# Keep it clean (no `/v1`) so routes like /auth/login and /health resolve properly.
export BASE=${BASE:-"http://127.0.0.1:${PORT}"}
export API_BASE=${API_BASE:-$BASE}

# ------------------------------------------------------------------------
# 4Ô∏è‚É£ Default test credentials & org info (optional but handy)
# ------------------------------------------------------------------------
export EMAIL=${EMAIL:-"tester@example.com"}
export PASS=${PASS:-"password123"}
export E2E_ORG_SLUG=${E2E_ORG_SLUG:-"demo"}

# Uncomment if you want to force org scope in local testing
# export ORG_ID=""
# export ORG_SLUG="demo"

# ------------------------------------------------------------------------
# 5Ô∏è‚É£ Developer convenience: Redis + Postgres (local Docker defaults)
# ------------------------------------------------------------------------
export DATABASE_URL=${DATABASE_URL:-"postgresql://postgres:postgres@localhost:5432/sbo?schema=public"}
export REDIS_URL=${REDIS_URL:-"redis://localhost:6379"}

# ------------------------------------------------------------------------
# 6Ô∏è‚É£ Debug summary when direnv loads
# ------------------------------------------------------------------------
echo "‚úÖ direnv loaded:"
echo "   BASE=$BASE"
echo "   PORT=$PORT"
echo "   EMAIL=$EMAIL"
echo "   JWT_SECRET length=${#JWT_SECRET}"
echo "   DATABASE_URL=${DATABASE_URL}"
echo "   REDIS_URL=${REDIS_URL}"

# ========================================================================
# ‚úÖ Done ‚Äî run 'direnv allow' once to activate auto-load on cd
# ========================================================================