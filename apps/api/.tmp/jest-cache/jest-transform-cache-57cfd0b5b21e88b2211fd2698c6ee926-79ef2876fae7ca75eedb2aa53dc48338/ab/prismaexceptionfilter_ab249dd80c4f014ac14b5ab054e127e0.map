{"file":"/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/src/common/filters/prisma-exception.filter.ts","mappings":";;;;;;;;;AAAA,2CAKwB;AAGxB;;;GAGG;AAEI,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;IAChC,KAAK,CAAC,SAAkB,EAAE,IAAmB;QAC3C,MAAM,GAAG,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAChC,MAAM,GAAG,GAAG,GAAG,CAAC,WAAW,EAAY,CAAC;QACxC,MAAM,GAAG,GAAG,GAAG,CAAC,UAAU,EAAW,CAAC;QAEtC,oBAAoB;QACpB,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,CAAC;YACpC,OAAO,GAAG,CAAC,MAAM,CAAC,mBAAU,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;gBAC1C,UAAU,EAAE,mBAAU,CAAC,QAAQ;gBAC/B,KAAK,EAAE,UAAU;gBACjB,OAAO,EAAE,6BAA6B;gBACtC,IAAI,EAAE,GAAG,CAAC,GAAG;aACd,CAAC,CAAC;QACL,CAAC;QAED,mBAAmB;QACnB,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,CAAC;YACpC,OAAO,GAAG,CAAC,MAAM,CAAC,mBAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC;gBAC3C,UAAU,EAAE,mBAAU,CAAC,SAAS;gBAChC,KAAK,EAAE,WAAW;gBAClB,OAAO,EAAE,kBAAkB;gBAC3B,IAAI,EAAE,GAAG,CAAC,GAAG;aACd,CAAC,CAAC;QACL,CAAC;QAED,6DAA6D;QAC7D,MAAM,SAAS,CAAC;IAClB,CAAC;IAEO,MAAM,CAAC,EAAW,EAAE,IAAY;QACtC,OAAO,CAAC,CAAC,EAAE,IAAI,OAAO,EAAE,KAAK,QAAQ,IAAI,MAAM,IAAI,EAAE,IAAK,EAAU,CAAC,IAAI,KAAK,IAAI,CAAC;IACrF,CAAC;CACF,CAAA;AAjCY,sDAAqB;gCAArB,qBAAqB;IADjC,IAAA,cAAK,GAAE;GACK,qBAAqB,CAiCjC","names":[],"sources":["/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/src/common/filters/prisma-exception.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpStatus,\n} from '@nestjs/common';\nimport { Request, Response } from 'express';\n\n/**\n * Prisma v6: don't import/use PrismaClientKnownRequestError class directly.\n * Narrow by \"code\" instead.\n */\n@Catch()\nexport class PrismaExceptionFilter implements ExceptionFilter {\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const res = ctx.getResponse<Response>();\n    const req = ctx.getRequest<Request>();\n\n    // Unique constraint\n    if (this.isCode(exception, 'P2002')) {\n      return res.status(HttpStatus.CONFLICT).json({\n        statusCode: HttpStatus.CONFLICT,\n        error: 'Conflict',\n        message: 'Unique constraint violation',\n        path: req.url,\n      });\n    }\n\n    // Record not found\n    if (this.isCode(exception, 'P2025')) {\n      return res.status(HttpStatus.NOT_FOUND).json({\n        statusCode: HttpStatus.NOT_FOUND,\n        error: 'Not Found',\n        message: 'Record not found',\n        path: req.url,\n      });\n    }\n\n    // Fallback: let Nest handle or other global filters catch it\n    throw exception;\n  }\n\n  private isCode(ex: unknown, code: string): ex is { code: string } {\n    return !!ex && typeof ex === 'object' && 'code' in ex && (ex as any).code === code;\n  }\n}"],"version":3}