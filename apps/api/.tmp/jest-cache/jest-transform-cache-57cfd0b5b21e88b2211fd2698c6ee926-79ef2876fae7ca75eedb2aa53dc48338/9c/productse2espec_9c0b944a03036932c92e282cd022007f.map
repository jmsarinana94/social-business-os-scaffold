{"file":"/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/test/products.e2e-spec.ts","mappings":"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","names":[],"sources":["/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/test/products.e2e-spec.ts"],"sourcesContent":["// apps/api/test/products.e2e-spec.ts\nimport 'reflect-metadata';\n\nimport { INestApplication, ValidationPipe } from '@nestjs/common';\nimport { Test } from '@nestjs/testing';\nimport { PrismaClient } from '@prisma/client';\nimport request from 'supertest';\n\nimport { AppModule } from '../src/app.module';\nimport { PrismaExceptionFilter } from '../src/common/filters/prisma-exception.filter';\n\nconst prisma = new PrismaClient();\nconst ORG_SLUG = process.env.TEST_ORG ?? 'demo';\n\ndescribe('Products (e2e)', () => {\n  let app: INestApplication;\n\n  beforeAll(async () => {\n    // reset DB\n    await prisma.$executeRawUnsafe('TRUNCATE TABLE \"Product\" RESTART IDENTITY CASCADE;');\n    await prisma.$executeRawUnsafe('TRUNCATE TABLE \"Organization\" RESTART IDENTITY CASCADE;');\n\n    // seed org\n    await prisma.organization.create({\n      data: { slug: ORG_SLUG, name: ORG_SLUG.toUpperCase() },\n    });\n\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));\n    app.useGlobalFilters(new PrismaExceptionFilter());\n    await app.init();\n  });\n\n  afterAll(async () => {\n    await app.close();\n    await prisma.$disconnect();\n  });\n\n  it('health', async () => {\n    const res = await request(app.getHttpServer()).get('/health').expect(200);\n    expect(res.body?.ok).toBe(true);\n  });\n\n  it('create/list/get/update/delete product', async () => {\n    const agent = request(app.getHttpServer());\n    const headers = { 'x-org': ORG_SLUG, 'content-type': 'application/json' };\n\n    // create\n    const createRes = await agent\n      .post('/products')\n      .set(headers)\n      .send({ title: 'Widget', type: 'physical', status: 'active', price: 12, description: 'Test' })\n      .expect(201);\n\n    const id = createRes.body.id ?? createRes.body.data?.id;\n    expect(id).toBeTruthy();\n\n    // get\n    const getRes = await agent.get(`/products/${id}`).set({ 'x-org': ORG_SLUG }).expect(200);\n    expect(getRes.body.title).toEqual('Widget');\n\n    // update\n    const updRes = await agent\n      .put(`/products/${id}`)\n      .set(headers)\n      .send({ title: 'Widget (updated)', price: 19 })\n      .expect(200);\n    expect(updRes.body.title).toEqual('Widget (updated)');\n\n    // list\n    const listRes = await agent.get('/products?page=1&limit=5').set({ 'x-org': ORG_SLUG }).expect(200);\n    expect(Array.isArray(listRes.body.data)).toBe(true);\n    expect(listRes.body.meta?.page).toBe(1);\n\n    // delete\n    await agent.delete(`/products/${id}`).set({ 'x-org': ORG_SLUG }).expect(200);\n    await agent.get(`/products/${id}`).set({ 'x-org': ORG_SLUG }).expect(404);\n  });\n\n  it('rejects missing x-org', async () => {\n    await request(app.getHttpServer()).get('/products').expect(400);\n  });\n});"],"version":3}