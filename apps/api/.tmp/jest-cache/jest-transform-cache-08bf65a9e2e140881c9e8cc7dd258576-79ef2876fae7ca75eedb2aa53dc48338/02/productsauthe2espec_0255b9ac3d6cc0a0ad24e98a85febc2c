358250a068388bfc84d77b964279d590
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const supertest_1 = __importDefault(require("supertest"));
const app_module_1 = require("../../src/app.module");
const auth_module_1 = require("../../src/modules/auth/auth.module");
describe('Products Auth (e2e)', () => {
    let app;
    const ORG = 'demo';
    const baseHeaders = { 'x-org': ORG };
    beforeAll(async () => {
        const moduleRef = await testing_1.Test.createTestingModule({
            imports: [app_module_1.AppModule, auth_module_1.AuthModule], // ðŸ‘ˆ add this
        }).compile();
        app = moduleRef.createNestApplication();
        await app.init();
    });
    afterAll(async () => {
        await app.close();
    });
    it('signup/login then CRUD with Bearer token', async () => {
        const server = app.getHttpServer();
        const email = `auth_${Date.now()}@example.com`;
        const password = 'secret123';
        await (0, supertest_1.default)(server)
            .post('/auth/signup')
            .set(baseHeaders)
            .send({ email, password, name: 'Test User' })
            .expect(201);
        const login = await (0, supertest_1.default)(server)
            .post('/auth/login')
            .set(baseHeaders)
            .send({ email, password })
            .expect(200);
        const token = login.body?.access_token || 'test-token';
        const headers = { ...baseHeaders, Authorization: `Bearer ${token}` };
        const created = await (0, supertest_1.default)(server)
            .post('/products')
            .set(headers)
            .send({ title: 'Thing', type: 'physical', status: 'active', price: 9.99 })
            .expect(201);
        const id = created.body.id ?? created.body.data?.id;
        await (0, supertest_1.default)(server).get(`/products/${id}`).set(headers).expect(200);
        await (0, supertest_1.default)(server).put(`/products/${id}`).set(headers).send({ description: 'updated' }).expect(200);
        await (0, supertest_1.default)(server).delete(`/products/${id}`).set(headers).expect(200);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hbm55c2FyaW5hbmEvRG93bmxvYWRzL3NvY2lhbC1idXNpbmVzcy1vcy1zY2FmZm9sZC12MC4yL2FwcHMvYXBpL3Rlc3QvZTJlL3Byb2R1Y3RzLmF1dGguZTJlLXNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSw2Q0FBdUM7QUFDdkMsMERBQWdDO0FBQ2hDLHFEQUFpRDtBQUNqRCxvRUFBZ0U7QUFFaEUsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxJQUFJLEdBQXFCLENBQUM7SUFFMUIsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDO0lBQ25CLE1BQU0sV0FBVyxHQUFHLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBRXJDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLFNBQVMsR0FBRyxNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMvQyxPQUFPLEVBQUUsQ0FBQyxzQkFBUyxFQUFFLHdCQUFVLENBQUMsRUFBRSxjQUFjO1NBQ2pELENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLEdBQUcsR0FBRyxTQUFTLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN4QyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNuQixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQixNQUFNLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN4RCxNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFbkMsTUFBTSxLQUFLLEdBQUcsUUFBUSxJQUFJLENBQUMsR0FBRyxFQUFFLGNBQWMsQ0FBQztRQUMvQyxNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUM7UUFFN0IsTUFBTSxJQUFBLG1CQUFPLEVBQUMsTUFBTSxDQUFDO2FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUM7YUFDcEIsR0FBRyxDQUFDLFdBQVcsQ0FBQzthQUNoQixJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQzthQUM1QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFZixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxNQUFNLENBQUM7YUFDaEMsSUFBSSxDQUFDLGFBQWEsQ0FBQzthQUNuQixHQUFHLENBQUMsV0FBVyxDQUFDO2FBQ2hCLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsQ0FBQzthQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFZixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFLFlBQVksSUFBSSxZQUFZLENBQUM7UUFDdkQsTUFBTSxPQUFPLEdBQUcsRUFBRSxHQUFHLFdBQVcsRUFBRSxhQUFhLEVBQUUsVUFBVSxLQUFLLEVBQUUsRUFBRSxDQUFDO1FBRXJFLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLE1BQU0sQ0FBQzthQUNsQyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ2pCLEdBQUcsQ0FBQyxPQUFPLENBQUM7YUFDWixJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDekUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWYsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO1FBRXBELE1BQU0sSUFBQSxtQkFBTyxFQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0RSxNQUFNLElBQUEsbUJBQU8sRUFBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzNFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hbm55c2FyaW5hbmEvRG93bmxvYWRzL3NvY2lhbC1idXNpbmVzcy1vcy1zY2FmZm9sZC12MC4yL2FwcHMvYXBpL3Rlc3QvZTJlL3Byb2R1Y3RzLmF1dGguZTJlLXNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSU5lc3RBcHBsaWNhdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCB7IEFwcE1vZHVsZSB9IGZyb20gJy4uLy4uL3NyYy9hcHAubW9kdWxlJztcbmltcG9ydCB7IEF1dGhNb2R1bGUgfSBmcm9tICcuLi8uLi9zcmMvbW9kdWxlcy9hdXRoL2F1dGgubW9kdWxlJztcblxuZGVzY3JpYmUoJ1Byb2R1Y3RzIEF1dGggKGUyZSknLCAoKSA9PiB7XG4gIGxldCBhcHA6IElOZXN0QXBwbGljYXRpb247XG5cbiAgY29uc3QgT1JHID0gJ2RlbW8nO1xuICBjb25zdCBiYXNlSGVhZGVycyA9IHsgJ3gtb3JnJzogT1JHIH07XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGVSZWYgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgaW1wb3J0czogW0FwcE1vZHVsZSwgQXV0aE1vZHVsZV0sIC8vIPCfkYggYWRkIHRoaXNcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBhcHAgPSBtb2R1bGVSZWYuY3JlYXRlTmVzdEFwcGxpY2F0aW9uKCk7XG4gICAgYXdhaXQgYXBwLmluaXQoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGFwcC5jbG9zZSgpO1xuICB9KTtcblxuICBpdCgnc2lnbnVwL2xvZ2luIHRoZW4gQ1JVRCB3aXRoIEJlYXJlciB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhcHAuZ2V0SHR0cFNlcnZlcigpO1xuXG4gICAgY29uc3QgZW1haWwgPSBgYXV0aF8ke0RhdGUubm93KCl9QGV4YW1wbGUuY29tYDtcbiAgICBjb25zdCBwYXNzd29yZCA9ICdzZWNyZXQxMjMnO1xuXG4gICAgYXdhaXQgcmVxdWVzdChzZXJ2ZXIpXG4gICAgICAucG9zdCgnL2F1dGgvc2lnbnVwJylcbiAgICAgIC5zZXQoYmFzZUhlYWRlcnMpXG4gICAgICAuc2VuZCh7IGVtYWlsLCBwYXNzd29yZCwgbmFtZTogJ1Rlc3QgVXNlcicgfSlcbiAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgIGNvbnN0IGxvZ2luID0gYXdhaXQgcmVxdWVzdChzZXJ2ZXIpXG4gICAgICAucG9zdCgnL2F1dGgvbG9naW4nKVxuICAgICAgLnNldChiYXNlSGVhZGVycylcbiAgICAgIC5zZW5kKHsgZW1haWwsIHBhc3N3b3JkIH0pXG4gICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICBjb25zdCB0b2tlbiA9IGxvZ2luLmJvZHk/LmFjY2Vzc190b2tlbiB8fCAndGVzdC10b2tlbic7XG4gICAgY29uc3QgaGVhZGVycyA9IHsgLi4uYmFzZUhlYWRlcnMsIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH07XG5cbiAgICBjb25zdCBjcmVhdGVkID0gYXdhaXQgcmVxdWVzdChzZXJ2ZXIpXG4gICAgICAucG9zdCgnL3Byb2R1Y3RzJylcbiAgICAgIC5zZXQoaGVhZGVycylcbiAgICAgIC5zZW5kKHsgdGl0bGU6ICdUaGluZycsIHR5cGU6ICdwaHlzaWNhbCcsIHN0YXR1czogJ2FjdGl2ZScsIHByaWNlOiA5Ljk5IH0pXG4gICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICBjb25zdCBpZCA9IGNyZWF0ZWQuYm9keS5pZCA/PyBjcmVhdGVkLmJvZHkuZGF0YT8uaWQ7XG5cbiAgICBhd2FpdCByZXF1ZXN0KHNlcnZlcikuZ2V0KGAvcHJvZHVjdHMvJHtpZH1gKS5zZXQoaGVhZGVycykuZXhwZWN0KDIwMCk7XG4gICAgYXdhaXQgcmVxdWVzdChzZXJ2ZXIpLnB1dChgL3Byb2R1Y3RzLyR7aWR9YCkuc2V0KGhlYWRlcnMpLnNlbmQoeyBkZXNjcmlwdGlvbjogJ3VwZGF0ZWQnIH0pLmV4cGVjdCgyMDApO1xuICAgIGF3YWl0IHJlcXVlc3Qoc2VydmVyKS5kZWxldGUoYC9wcm9kdWN0cy8ke2lkfWApLnNldChoZWFkZXJzKS5leHBlY3QoMjAwKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=