{"file":"/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/src/modules/auth/auth.controller.ts","mappings":";;;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,2CAWwB;AACxB,+CAA6C;AAC7C,iDAA6C;AAE7C,MAAM,SAAS;CAId;AACD,MAAM,QAAQ;CAGb;AAGM,IAAM,cAAc,GAApB,MAAM,cAAc;IACzB,YAA6B,IAAiB;QAAjB,SAAI,GAAJ,IAAI,CAAa;IAAG,CAAC;IAE1C,UAAU,CAAC,OAA2C;QAC5D,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,CAAC,IAAI;YAAE,MAAM,IAAI,4BAAmB,CAAC,sBAAsB,CAAC,CAAC;QACjE,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;IACtB,CAAC;IAIK,AAAN,KAAK,CAAC,MAAM,CAAY,OAAY,EAAU,GAAc;QAC1D,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,KAAK,EAAE,QAAQ,EAAE,GAAG,CAAC,QAAQ,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;IACnG,CAAC;IAIK,AAAN,KAAK,CAAC,KAAK,CAAY,OAAY,EAAU,GAAa;QACxD,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,KAAK,EAAE,QAAQ,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;IAClF,CAAC;IAKK,AAAN,KAAK,CAAC,EAAE,CAAQ,GAAQ;QACtB,iDAAiD;QACjD,MAAM,MAAM,GAAuB,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC;QACpD,IAAI,CAAC,MAAM;YAAE,MAAM,IAAI,4BAAmB,CAAC,eAAe,CAAC,CAAC;QAC5D,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IAC9B,CAAC;CACF,CAAA;AAhCY,wCAAc;AAWnB;IAFL,IAAA,aAAI,EAAC,QAAQ,CAAC;IACd,IAAA,iBAAQ,EAAC,mBAAU,CAAC,OAAO,CAAC;IACf,WAAA,IAAA,gBAAO,GAAE,CAAA;IAAgB,WAAA,IAAA,aAAI,GAAE,CAAA;;6CAAM,SAAS;;4CAG3D;AAIK;IAFL,IAAA,aAAI,EAAC,OAAO,CAAC;IACb,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IACX,WAAA,IAAA,gBAAO,GAAE,CAAA;IAAgB,WAAA,IAAA,aAAI,GAAE,CAAA;;6CAAM,QAAQ;;2CAGzD;AAKK;IAHL,IAAA,YAAG,EAAC,IAAI,CAAC;IACT,IAAA,kBAAS,EAAC,IAAA,oBAAS,EAAC,KAAK,CAAC,CAAC;IAC3B,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IACd,WAAA,IAAA,YAAG,GAAE,CAAA;;;;wCAKd;yBA/BU,cAAc;IAD1B,IAAA,mBAAU,EAAC,MAAM,CAAC;qCAEkB,0BAAW;GADnC,cAAc,CAgC1B","names":[],"sources":["/Users/mannysarinana/Downloads/social-business-os-scaffold-v0.2/apps/api/src/modules/auth/auth.controller.ts"],"sourcesContent":["// apps/api/src/modules/auth/auth.controller.ts\nimport {\n  BadRequestException,\n  Body,\n  Controller,\n  Get,\n  Headers,\n  HttpCode,\n  HttpStatus,\n  Post,\n  Req,\n  UseGuards,\n} from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { AuthService } from './auth.service';\n\nclass SignupDto {\n  email!: string;\n  password!: string;\n  name?: string;\n}\nclass LoginDto {\n  email!: string;\n  password!: string;\n}\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private readonly auth: AuthService) {}\n\n  private getOrgSlug(headers: Record<string, string | undefined>): string {\n    const slug = headers['x-org'];\n    if (!slug) throw new BadRequestException('Missing x-org header');\n    return String(slug);\n  }\n\n  @Post('signup')\n  @HttpCode(HttpStatus.CREATED)\n  async signup(@Headers() headers: any, @Body() dto: SignupDto) {\n    const slug = this.getOrgSlug(headers);\n    return this.auth.signup({ org: slug, email: dto.email, password: dto.password, name: dto.name });\n  }\n\n  @Post('login')\n  @HttpCode(HttpStatus.OK)\n  async login(@Headers() headers: any, @Body() dto: LoginDto) {\n    const slug = this.getOrgSlug(headers);\n    return this.auth.login({ org: slug, email: dto.email, password: dto.password });\n  }\n\n  @Get('me')\n  @UseGuards(AuthGuard('jwt'))\n  @HttpCode(HttpStatus.OK)\n  async me(@Req() req: any) {\n    // JwtStrategy.validate returns { userId, email }\n    const userId: string | undefined = req.user?.userId;\n    if (!userId) throw new BadRequestException('Invalid token');\n    return this.auth.me(userId);\n  }\n}"],"version":3}