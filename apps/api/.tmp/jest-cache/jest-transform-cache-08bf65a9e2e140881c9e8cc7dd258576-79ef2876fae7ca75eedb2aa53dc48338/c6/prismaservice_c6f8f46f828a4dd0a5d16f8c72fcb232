3215dcf08c0c5096bb53dd5579d822f5
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PrismaService = void 0;
const common_1 = require("@nestjs/common");
const client_1 = require("@prisma/client");
/**
 * PrismaService for NestJS (library engine, Prisma >=5).
 * - Connect on module init
 * - Disconnect on module destroy
 * - Also attach process-level listeners so Jest/e2e and dev server exit cleanly.
 */
let PrismaService = class PrismaService extends client_1.PrismaClient {
    constructor() {
        super({
            // keep noisy logs off in tests; feel free to tweak
            log: process.env.NODE_ENV === 'test' ? [] : ['warn', 'error'],
        });
        this.setupProcessListeners();
    }
    async onModuleInit() {
        await this.$connect();
    }
    async onModuleDestroy() {
        await this.$disconnect();
    }
    /** Graceful shutdown for library engine: attach to Node's process events. */
    setupProcessListeners() {
        const disconnect = async () => {
            try {
                await this.$disconnect();
            }
            catch {
                // ignore â€” we're shutting down
            }
        };
        // Fires when the event loop is empty and Node is about to exit
        process.on('beforeExit', disconnect);
        // Common termination signals
        process.on('SIGINT', disconnect);
        process.on('SIGTERM', disconnect);
        // Nodemon sends SIGUSR2; re-emit after cleanup so it can restart
        process.on('SIGUSR2', async () => {
            await disconnect();
            process.kill(process.pid, 'SIGUSR2');
        });
    }
};
exports.PrismaService = PrismaService;
exports.PrismaService = PrismaService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], PrismaService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hbm55c2FyaW5hbmEvRG93bmxvYWRzL3NvY2lhbC1idXNpbmVzcy1vcy1zY2FmZm9sZC12MC4yL2FwcHMvYXBpL3NyYy9wcmlzbWEvcHJpc21hLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTJFO0FBQzNFLDJDQUFzRDtBQUV0RDs7Ozs7R0FLRztBQUVJLElBQU0sYUFBYSxHQUFuQixNQUFNLGFBQ1gsU0FBUSxxQkFBd0M7SUFHaEQ7UUFDRSxLQUFLLENBQUM7WUFDSixtREFBbUQ7WUFDbkQsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUM7U0FDaEMsQ0FBQyxDQUFDO1FBRWpDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNoQixNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQsS0FBSyxDQUFDLGVBQWU7UUFDbkIsTUFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVELDZFQUE2RTtJQUNyRSxxQkFBcUI7UUFDM0IsTUFBTSxVQUFVLEdBQUcsS0FBSyxJQUFJLEVBQUU7WUFDNUIsSUFBSSxDQUFDO2dCQUNILE1BQU0sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzNCLENBQUM7WUFBQyxNQUFNLENBQUM7Z0JBQ1AsK0JBQStCO1lBQ2pDLENBQUM7UUFDSCxDQUFDLENBQUM7UUFFRiwrREFBK0Q7UUFDL0QsT0FBTyxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDckMsNkJBQTZCO1FBQzdCLE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRWxDLGlFQUFpRTtRQUNqRSxPQUFPLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQixNQUFNLFVBQVUsRUFBRSxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRixDQUFBO0FBM0NZLHNDQUFhO3dCQUFiLGFBQWE7SUFEekIsSUFBQSxtQkFBVSxHQUFFOztHQUNBLGFBQWEsQ0EyQ3pCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYW5ueXNhcmluYW5hL0Rvd25sb2Fkcy9zb2NpYWwtYnVzaW5lc3Mtb3Mtc2NhZmZvbGQtdjAuMi9hcHBzL2FwaS9zcmMvcHJpc21hL3ByaXNtYS5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9uTW9kdWxlRGVzdHJveSwgT25Nb2R1bGVJbml0IH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hLCBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbi8qKlxuICogUHJpc21hU2VydmljZSBmb3IgTmVzdEpTIChsaWJyYXJ5IGVuZ2luZSwgUHJpc21hID49NSkuXG4gKiAtIENvbm5lY3Qgb24gbW9kdWxlIGluaXRcbiAqIC0gRGlzY29ubmVjdCBvbiBtb2R1bGUgZGVzdHJveVxuICogLSBBbHNvIGF0dGFjaCBwcm9jZXNzLWxldmVsIGxpc3RlbmVycyBzbyBKZXN0L2UyZSBhbmQgZGV2IHNlcnZlciBleGl0IGNsZWFubHkuXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQcmlzbWFTZXJ2aWNlXG4gIGV4dGVuZHMgUHJpc21hQ2xpZW50PFByaXNtYS5QcmlzbWFDbGllbnRPcHRpb25zPlxuICBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCwgT25Nb2R1bGVEZXN0cm95XG57XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHtcbiAgICAgIC8vIGtlZXAgbm9pc3kgbG9ncyBvZmYgaW4gdGVzdHM7IGZlZWwgZnJlZSB0byB0d2Vha1xuICAgICAgbG9nOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnID8gW10gOiBbJ3dhcm4nLCAnZXJyb3InXSxcbiAgICB9IGFzIFByaXNtYS5QcmlzbWFDbGllbnRPcHRpb25zKTtcblxuICAgIHRoaXMuc2V0dXBQcm9jZXNzTGlzdGVuZXJzKCk7XG4gIH1cblxuICBhc3luYyBvbk1vZHVsZUluaXQoKSB7XG4gICAgYXdhaXQgdGhpcy4kY29ubmVjdCgpO1xuICB9XG5cbiAgYXN5bmMgb25Nb2R1bGVEZXN0cm95KCkge1xuICAgIGF3YWl0IHRoaXMuJGRpc2Nvbm5lY3QoKTtcbiAgfVxuXG4gIC8qKiBHcmFjZWZ1bCBzaHV0ZG93biBmb3IgbGlicmFyeSBlbmdpbmU6IGF0dGFjaCB0byBOb2RlJ3MgcHJvY2VzcyBldmVudHMuICovXG4gIHByaXZhdGUgc2V0dXBQcm9jZXNzTGlzdGVuZXJzKCkge1xuICAgIGNvbnN0IGRpc2Nvbm5lY3QgPSBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLiRkaXNjb25uZWN0KCk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gaWdub3JlIOKAlCB3ZSdyZSBzaHV0dGluZyBkb3duXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEZpcmVzIHdoZW4gdGhlIGV2ZW50IGxvb3AgaXMgZW1wdHkgYW5kIE5vZGUgaXMgYWJvdXQgdG8gZXhpdFxuICAgIHByb2Nlc3Mub24oJ2JlZm9yZUV4aXQnLCBkaXNjb25uZWN0KTtcbiAgICAvLyBDb21tb24gdGVybWluYXRpb24gc2lnbmFsc1xuICAgIHByb2Nlc3Mub24oJ1NJR0lOVCcsIGRpc2Nvbm5lY3QpO1xuICAgIHByb2Nlc3Mub24oJ1NJR1RFUk0nLCBkaXNjb25uZWN0KTtcblxuICAgIC8vIE5vZGVtb24gc2VuZHMgU0lHVVNSMjsgcmUtZW1pdCBhZnRlciBjbGVhbnVwIHNvIGl0IGNhbiByZXN0YXJ0XG4gICAgcHJvY2Vzcy5vbignU0lHVVNSMicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRpc2Nvbm5lY3QoKTtcbiAgICAgIHByb2Nlc3Mua2lsbChwcm9jZXNzLnBpZCwgJ1NJR1VTUjInKTtcbiAgICB9KTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==