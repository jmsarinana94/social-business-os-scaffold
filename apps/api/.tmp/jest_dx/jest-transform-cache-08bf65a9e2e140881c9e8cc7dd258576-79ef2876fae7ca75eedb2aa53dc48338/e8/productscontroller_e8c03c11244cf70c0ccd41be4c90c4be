3ab3b59c7c272232d31a5d43cfdb490e
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProductsController = void 0;
const org_guard_1 = require("@/common/guards/org.guard");
const common_1 = require("@nestjs/common");
const adjust_inventory_dto_1 = require("./dto/adjust-inventory.dto");
const create_product_dto_1 = require("./dto/create-product.dto");
const update_product_dto_1 = require("./dto/update-product.dto");
const products_service_1 = require("./products.service");
let ProductsController = class ProductsController {
    constructor(svc) {
        this.svc = svc;
    }
    list(org, page, limit) {
        return this.svc.list(org, Number(page ?? 1), Number(limit ?? 10));
    }
    get(org, id) {
        return this.svc.get(org, id);
    }
    create(org, dto) {
        return this.svc.create(org, dto);
    }
    update(org, id, dto) {
        return this.svc.update(org, id, dto);
    }
    remove(org, id) {
        return this.svc.remove(org, id);
    }
    // NEW: Adjust inventory by delta (positive or negative)
    adjustInventory(org, id, dto) {
        return this.svc.adjustInventory(org, id, dto.delta);
    }
};
exports.ProductsController = ProductsController;
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Query)('page')),
    __param(2, (0, common_1.Query)('limit')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, Object]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "list", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "get", null);
__decorate([
    (0, common_1.Post)(),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, create_product_dto_1.CreateProductDto]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "create", null);
__decorate([
    (0, common_1.Put)(':id'),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Param)('id')),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, update_product_dto_1.UpdateProductDto]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)(':id/inventory'),
    __param(0, (0, common_1.Headers)('x-org')),
    __param(1, (0, common_1.Param)('id')),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, adjust_inventory_dto_1.AdjustInventoryDto]),
    __metadata("design:returntype", void 0)
], ProductsController.prototype, "adjustInventory", null);
exports.ProductsController = ProductsController = __decorate([
    (0, common_1.Controller)('products'),
    (0, common_1.UseGuards)(org_guard_1.OrgHeaderGuard),
    __metadata("design:paramtypes", [products_service_1.ProductsService])
], ProductsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hbm55c2FyaW5hbmEvRG93bmxvYWRzL3NvY2lhbC1idXNpbmVzcy1vcy1zY2FmZm9sZC12MC4yL2FwcHMvYXBpL3NyYy9tb2R1bGVzL3Byb2R1Y3RzL3Byb2R1Y3RzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseURBQTJEO0FBQzNELDJDQVd3QjtBQUN4QixxRUFBZ0U7QUFDaEUsaUVBQTREO0FBQzVELGlFQUE0RDtBQUM1RCx5REFBcUQ7QUFJOUMsSUFBTSxrQkFBa0IsR0FBeEIsTUFBTSxrQkFBa0I7SUFDN0IsWUFBNkIsR0FBb0I7UUFBcEIsUUFBRyxHQUFILEdBQUcsQ0FBaUI7SUFBRyxDQUFDO0lBR3JELElBQUksQ0FDZ0IsR0FBVyxFQUNkLElBQXNCLEVBQ3JCLEtBQXVCO1FBRXZDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFHRCxHQUFHLENBQW1CLEdBQVcsRUFBZSxFQUFVO1FBQ3hELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFHRCxNQUFNLENBQW1CLEdBQVcsRUFBVSxHQUFxQjtRQUNqRSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBR0QsTUFBTSxDQUFtQixHQUFXLEVBQWUsRUFBVSxFQUFVLEdBQXFCO1FBQzFGLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBR0QsTUFBTSxDQUFtQixHQUFXLEVBQWUsRUFBVTtRQUMzRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsd0RBQXdEO0lBRXhELGVBQWUsQ0FDSyxHQUFXLEVBQ2hCLEVBQVUsRUFDZixHQUF1QjtRQUUvQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RELENBQUM7Q0FDRixDQUFBO0FBekNZLGdEQUFrQjtBQUk3QjtJQURDLElBQUEsWUFBRyxHQUFFO0lBRUgsV0FBQSxJQUFBLGdCQUFPLEVBQUMsT0FBTyxDQUFDLENBQUE7SUFDaEIsV0FBQSxJQUFBLGNBQUssRUFBQyxNQUFNLENBQUMsQ0FBQTtJQUNiLFdBQUEsSUFBQSxjQUFLLEVBQUMsT0FBTyxDQUFDLENBQUE7Ozs7OENBR2hCO0FBR0Q7SUFEQyxJQUFBLFlBQUcsRUFBQyxLQUFLLENBQUM7SUFDTixXQUFBLElBQUEsZ0JBQU8sRUFBQyxPQUFPLENBQUMsQ0FBQTtJQUFlLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSxDQUFDLENBQUE7Ozs7NkNBRTlDO0FBR0Q7SUFEQyxJQUFBLGFBQUksR0FBRTtJQUNDLFdBQUEsSUFBQSxnQkFBTyxFQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQWUsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBOzs2Q0FBTSxxQ0FBZ0I7O2dEQUVsRTtBQUdEO0lBREMsSUFBQSxZQUFHLEVBQUMsS0FBSyxDQUFDO0lBQ0gsV0FBQSxJQUFBLGdCQUFPLEVBQUMsT0FBTyxDQUFDLENBQUE7SUFBZSxXQUFBLElBQUEsY0FBSyxFQUFDLElBQUksQ0FBQyxDQUFBO0lBQWMsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBOztxREFBTSxxQ0FBZ0I7O2dEQUUzRjtBQUdEO0lBREMsSUFBQSxlQUFNLEVBQUMsS0FBSyxDQUFDO0lBQ04sV0FBQSxJQUFBLGdCQUFPLEVBQUMsT0FBTyxDQUFDLENBQUE7SUFBZSxXQUFBLElBQUEsY0FBSyxFQUFDLElBQUksQ0FBQyxDQUFBOzs7O2dEQUVqRDtBQUlEO0lBREMsSUFBQSxhQUFJLEVBQUMsZUFBZSxDQUFDO0lBRW5CLFdBQUEsSUFBQSxnQkFBTyxFQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ2hCLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSxDQUFDLENBQUE7SUFDWCxXQUFBLElBQUEsYUFBSSxHQUFFLENBQUE7O3FEQUFNLHlDQUFrQjs7eURBR2hDOzZCQXhDVSxrQkFBa0I7SUFGOUIsSUFBQSxtQkFBVSxFQUFDLFVBQVUsQ0FBQztJQUN0QixJQUFBLGtCQUFTLEVBQUMsMEJBQWMsQ0FBQztxQ0FFVSxrQ0FBZTtHQUR0QyxrQkFBa0IsQ0F5QzlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYW5ueXNhcmluYW5hL0Rvd25sb2Fkcy9zb2NpYWwtYnVzaW5lc3Mtb3Mtc2NhZmZvbGQtdjAuMi9hcHBzL2FwaS9zcmMvbW9kdWxlcy9wcm9kdWN0cy9wcm9kdWN0cy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9yZ0hlYWRlckd1YXJkIH0gZnJvbSAnQC9jb21tb24vZ3VhcmRzL29yZy5ndWFyZCc7XG5pbXBvcnQge1xuICBCb2R5LFxuICBDb250cm9sbGVyLFxuICBEZWxldGUsXG4gIEdldCxcbiAgSGVhZGVycyxcbiAgUGFyYW0sXG4gIFBvc3QsXG4gIFB1dCxcbiAgUXVlcnksXG4gIFVzZUd1YXJkcyxcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQWRqdXN0SW52ZW50b3J5RHRvIH0gZnJvbSAnLi9kdG8vYWRqdXN0LWludmVudG9yeS5kdG8nO1xuaW1wb3J0IHsgQ3JlYXRlUHJvZHVjdER0byB9IGZyb20gJy4vZHRvL2NyZWF0ZS1wcm9kdWN0LmR0byc7XG5pbXBvcnQgeyBVcGRhdGVQcm9kdWN0RHRvIH0gZnJvbSAnLi9kdG8vdXBkYXRlLXByb2R1Y3QuZHRvJztcbmltcG9ydCB7IFByb2R1Y3RzU2VydmljZSB9IGZyb20gJy4vcHJvZHVjdHMuc2VydmljZSc7XG5cbkBDb250cm9sbGVyKCdwcm9kdWN0cycpXG5AVXNlR3VhcmRzKE9yZ0hlYWRlckd1YXJkKVxuZXhwb3J0IGNsYXNzIFByb2R1Y3RzQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgc3ZjOiBQcm9kdWN0c1NlcnZpY2UpIHt9XG5cbiAgQEdldCgpXG4gIGxpc3QoXG4gICAgQEhlYWRlcnMoJ3gtb3JnJykgb3JnOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KCdwYWdlJykgcGFnZT86IHN0cmluZyB8IG51bWJlcixcbiAgICBAUXVlcnkoJ2xpbWl0JykgbGltaXQ/OiBzdHJpbmcgfCBudW1iZXIsXG4gICkge1xuICAgIHJldHVybiB0aGlzLnN2Yy5saXN0KG9yZywgTnVtYmVyKHBhZ2UgPz8gMSksIE51bWJlcihsaW1pdCA/PyAxMCkpO1xuICB9XG5cbiAgQEdldCgnOmlkJylcbiAgZ2V0KEBIZWFkZXJzKCd4LW9yZycpIG9yZzogc3RyaW5nLCBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnN2Yy5nZXQob3JnLCBpZCk7XG4gIH1cblxuICBAUG9zdCgpXG4gIGNyZWF0ZShASGVhZGVycygneC1vcmcnKSBvcmc6IHN0cmluZywgQEJvZHkoKSBkdG86IENyZWF0ZVByb2R1Y3REdG8pIHtcbiAgICByZXR1cm4gdGhpcy5zdmMuY3JlYXRlKG9yZywgZHRvKTtcbiAgfVxuXG4gIEBQdXQoJzppZCcpXG4gIHVwZGF0ZShASGVhZGVycygneC1vcmcnKSBvcmc6IHN0cmluZywgQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcsIEBCb2R5KCkgZHRvOiBVcGRhdGVQcm9kdWN0RHRvKSB7XG4gICAgcmV0dXJuIHRoaXMuc3ZjLnVwZGF0ZShvcmcsIGlkLCBkdG8pO1xuICB9XG5cbiAgQERlbGV0ZSgnOmlkJylcbiAgcmVtb3ZlKEBIZWFkZXJzKCd4LW9yZycpIG9yZzogc3RyaW5nLCBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnN2Yy5yZW1vdmUob3JnLCBpZCk7XG4gIH1cblxuICAvLyBORVc6IEFkanVzdCBpbnZlbnRvcnkgYnkgZGVsdGEgKHBvc2l0aXZlIG9yIG5lZ2F0aXZlKVxuICBAUG9zdCgnOmlkL2ludmVudG9yeScpXG4gIGFkanVzdEludmVudG9yeShcbiAgICBASGVhZGVycygneC1vcmcnKSBvcmc6IHN0cmluZyxcbiAgICBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyxcbiAgICBAQm9keSgpIGR0bzogQWRqdXN0SW52ZW50b3J5RHRvLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5zdmMuYWRqdXN0SW52ZW50b3J5KG9yZywgaWQsIGR0by5kZWx0YSk7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=