openapi: 3.0.3
info:
  title: Social Business OS API (Mock)
  version: 1.0.0
servers:
  - url: http://127.0.0.1:4010

paths:
  /auth/signup:
    post:
      summary: Sign up a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string, minLength: 6 }
            examples:
              ok:
                value:
                  email: tester@example.com
                  password: secret123
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                required: [id, email]
                properties:
                  id: { type: string }
                  email: { type: string, format: email }
              examples:
                created:
                  value:
                    id: user_123
                    email: tester@example.com
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                tooShort:
                  value:
                    message: password must be at least 6 characters

  /auth/login:
    post:
      summary: Login and get token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
            examples:
              ok:
                value:
                  email: tester@example.com
                  password: secret123
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                required: [token]
                properties:
                  token: { type: string }
              examples:
                token:
                  value:
                    token: ey.mock.jwt.token

  /auth/me:
    get:
      summary: Get current user
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                type: object
                required: [id, email]
                properties:
                  id: { type: string }
                  email: { type: string, format: email }
              examples:
                me:
                  value:
                    id: user_123
                    email: tester@example.com
        '401':
          description: Missing/invalid token
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                noAuth:
                  value:
                    message: Unauthorized

  /orgs:
    post:
      summary: Create org
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, slug]
              properties:
                name: { type: string }
                slug: { type: string }
            examples:
              create:
                value:
                  name: Test Org
                  slug: test-org
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                required: [id, name, slug]
                properties:
                  id: { type: string }
                  name: { type: string }
                  slug: { type: string }
              examples:
                created:
                  value:
                    id: org_123
                    name: Test Org
                    slug: test-org
    get:
      summary: List orgs
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required: [id, name, slug]
                  properties:
                    id: { type: string }
                    name: { type: string }
                    slug: { type: string }
              examples:
                list:
                  value:
                    - id: org_123
                      name: Test Org
                      slug: test-org

  /accounts:
    get:
      summary: List accounts (org-scoped)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: query
          name: search
          schema: { type: string, nullable: true }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Account' }
              examples:
                list:
                  value:
                    - id: acc_123
                      orgId: org_123
                      name: TestCo
                      website: https://example.com
                      createdAt: '2024-01-01T00:00:00.000Z'
                      updatedAt: '2024-01-01T00:00:00.000Z'
        '400':
          description: Missing headers
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                missing:
                  value:
                    message: "request.header: Request header must have required property 'authorization' and 'x-org'"
    post:
      summary: Create account (org-scoped)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountWrite'
            examples:
              createExample:
                value:
                  name: TestCo
                  website: https://example.com
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
              examples:
                created:
                  value:
                    id: acc_123
                    orgId: org_123
                    name: TestCo
                    website: https://example.com
                    createdAt: '2024-01-01T00:00:00.000Z'
                    updatedAt: '2024-01-01T00:00:00.000Z'

  /accounts/{id}:
    get:
      summary: Get account by id (org-scoped)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
              examples:
                one:
                  value:
                    id: acc_123
                    orgId: org_123
                    name: TestCo
                    website: https://example.com
                    createdAt: '2024-01-01T00:00:00.000Z'
                    updatedAt: '2024-01-01T00:00:00.000Z'
        '404':
          description: Not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                notFound:
                  value:
                    message: Account not found
    delete:
      summary: Delete account by id (org-scoped)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204':
          description: No Content
        '404':
          description: Not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                notFound:
                  value:
                    message: Account not found

  /products:
    get:
      summary: List products
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - in: query
          name: sku
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100, default: 50 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
              examples:
                list:
                  value:
                    - id: prod_1
                      orgId: org_123
                      sku: ABC-001
                      title: Hoodie
                      type: PHYSICAL
                      status: ACTIVE
                      price: 39.99
                      inventoryQty: 12
                      lastPurchasedAt: '2024-01-10T12:00:00.000Z'
    post:
      summary: Upsert product (org-scoped)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/ProductWrite'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              examples:
                saved:
                  value:
                    id: prod_1
                    orgId: org_123
                    sku: ABC-001
                    title: Hoodie
                    type: PHYSICAL
                    status: ACTIVE
                    price: 39.99
                    inventoryQty: 12
                    lastPurchasedAt: '2024-01-10T12:00:00.000Z'

  /products/{id}:
    get:
      summary: Get product by id
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              examples:
                one:
                  value:
                    id: prod_1
                    orgId: org_123
                    sku: ABC-001
                    title: Hoodie
                    type: PHYSICAL
                    status: ACTIVE
                    price: 39.99
                    inventoryQty: 12
                    lastPurchasedAt: '2024-01-10T12:00:00.000Z'
    patch:
      summary: Update product (partial)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                title: { type: string }
                status: { type: string, enum: [ACTIVE, INACTIVE] }
                price: { type: number }
                inventoryQty: { type: integer, minimum: 0 }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              examples:
                updated:
                  value:
                    id: prod_1
                    orgId: org_123
                    sku: ABC-001
                    title: Hoodie v2
                    type: PHYSICAL
                    status: ACTIVE
                    price: 42.00
                    inventoryQty: 10
                    lastPurchasedAt: '2024-01-10T12:00:00.000Z'
    delete:
      summary: Delete product
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204':
          description: No Content

  /products/{id}/inventory:
    post:
      summary: Adjust inventory for a product
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [delta]
              properties:
                delta: { type: integer, description: 'Positive or negative adjustment' }
            examples:
              add5:
                value:
                  delta: 5
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              examples:
                afterAdjustment:
                  value:
                    id: prod_1
                    orgId: org_123
                    sku: ABC-001
                    title: Hoodie
                    type: PHYSICAL
                    status: ACTIVE
                    price: 39.99
                    inventoryQty: 17
                    lastPurchasedAt: '2024-01-10T12:00:00.000Z'
        '400':
          description: Invalid adjustment
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                overshoot:
                  value:
                    message: Inventory cannot be negative

  /orders:
    get:
      summary: List orders (most recent first)
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Order' }
              examples:
                list:
                  value:
                    - id: ord_1
                      orgId: org_123
                      totalQty: 2
                      totalPrice: '79.98'
                      createdAt: '2024-02-01T10:00:00.000Z'
                      items:
                        - id: item_1
                          orderId: ord_1
                          productId: prod_1
                          qty: 2
                          unitPrice: '39.99'
    post:
      summary: Create order
      parameters:
        - $ref: '#/components/parameters/AuthHeader'
        - $ref: '#/components/parameters/OrgHeader'
        - in: header
          name: Idempotency-Key
          required: false
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required: [productId, qty, unitPrice]
                    properties:
                      productId: { type: string }
                      qty: { type: integer, minimum: 1 }
                      unitPrice: { type: string, pattern: '^[0-9]+(\.[0-9]{2})$' }
            examples:
              simple:
                value:
                  items:
                    - productId: prod_1
                      qty: 2
                      unitPrice: '39.99'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Order' }
              examples:
                created:
                  value:
                    id: ord_1
                    orgId: org_123
                    totalQty: 2
                    totalPrice: '79.98'
                    createdAt: '2024-02-01T10:00:00.000Z'
                    items:
                      - id: item_1
                        orderId: ord_1
                        productId: prod_1
                        qty: 2
                        unitPrice: '39.99'

components:
  parameters:
    AuthHeader:
      in: header
      name: Authorization
      required: true
      schema:
        type: string
      description: 'Bearer {token}'
    OrgHeader:
      in: header
      name: X-Org
      required: true
      schema:
        type: string
      description: Organization slug

  schemas:
    Error:
      type: object
      properties:
        message: { type: string }

    Account:
      type: object
      required: [id, orgId, name, createdAt, updatedAt]
      properties:
        id: { type: string }
        orgId: { type: string }
        name: { type: string }
        website: { type: string, nullable: true, format: uri }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    AccountWrite:
      type: object
      required: [name]
      additionalProperties: false
      properties:
        name: { type: string }
        website: { type: string, nullable: true, format: uri }

    Product:
      type: object
      required: [id, orgId, sku, title, type, status, price, inventoryQty]
      properties:
        id: { type: string }
        orgId: { type: string }
        sku: { type: string }
        title: { type: string }
        type: { type: string, enum: [PHYSICAL, DIGITAL] }
        status: { type: string, enum: [ACTIVE, INACTIVE] }
        price: { type: number }
        inventoryQty: { type: integer }
        lastPurchasedAt: { type: string, format: date-time }

    ProductWrite:
      type: object
      required: [sku, title, type, status, price, inventoryQty]
      additionalProperties: false
      properties:
        sku: { type: string }
        title: { type: string }
        type: { type: string, enum: [PHYSICAL, DIGITAL] }
        status: { type: string, enum: [ACTIVE, INACTIVE] }
        price: { type: number }
        inventoryQty: { type: integer, minimum: 0 }

    OrderItem:
      type: object
      required: [id, orderId, productId, qty, unitPrice]
      properties:
        id: { type: string }
        orderId: { type: string }
        productId: { type: string }
        qty: { type: integer }
        unitPrice: { type: string }

    Order:
      type: object
      required: [id, orgId, totalQty, totalPrice, createdAt, items]
      properties:
        id: { type: string }
        orgId: { type: string }
        totalQty: { type: integer }
        totalPrice: { type: string }
        createdAt: { type: string, format: date-time }
        items:
          type: array
          items: { $ref: '#/components/schemas/OrderItem' }
